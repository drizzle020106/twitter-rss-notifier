name: RSS Monitor
on:
  schedule:
    - cron: "*/30 * * * *"  # æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  monitor-rss:
    runs-on: ubuntu-latest
    
    steps:
      # æ­¥éª¤1ï¼šè·å–RSSæœ€æ–°å†…å®¹
      - name: Parse RSS feed
        id: parse-rss
        run: |
          # å®‰è£…ä¾èµ–ï¼ˆxmlstarletç”¨äºè§£æXMLï¼‰
          sudo apt-get -qq install xmlstarlet
          
          # ä¸‹è½½RSSå†…å®¹
          curl -s "https://nitter.poast.org/elonmusk/rss" > feed.xml
          
          # æå–æœ€æ–°æ¡ç›®æ ‡é¢˜å’Œé“¾æ¥
          LATEST_TITLE=$(xmlstarlet sel -t -v "//item[1]/title" feed.xml | head -1)
          LATEST_LINK=$(xmlstarlet sel -t -v "//item[1]/link" feed.xml | head -1)
          
          # å­˜å‚¨è¾“å‡ºå˜é‡
          echo "title=$LATEST_TITLE" >> $GITHUB_OUTPUT
          echo "link=$LATEST_LINK" >> $GITHUB_OUTPUT

      # æ­¥éª¤2ï¼šæ¨é€é€šçŸ¥ï¼ˆå¾®ä¿¡ç¤ºä¾‹ï¼‰
      - name: Send Notification
        run: |
          curl -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "${{ secrets.WXPUSHER_TOKEN }}",
            "content": "ğŸ“¢ æ–°å†…å®¹æ›´æ–°\næ ‡é¢˜: ${{ steps.parse-rss.outputs.title }}\né“¾æ¥: ${{ steps.parse-rss.outputs.link }}",
            "topicId": "41341"  # â† æ›¿æ¢ä¸ºå®é™…ä¸»é¢˜ID
          }'
